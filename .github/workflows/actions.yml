# This is a basic workflow to help you get started with Actions

name: Build Hugo site and deploy to S3

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

concurrency:
  group: "pages"
  cancel-in-progress: false

permissions:
  contents: write
  pages: write
  id-token: write

defaults:
  run:
    shell: bash

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
      runs-on: ubuntu-latest
      env:
        HUGO_VERSION: 0.115.1
      steps:

        - name: Checkout
          uses: actions/checkout@v3

        - name: Setup Hugo
          uses: peaceiris/actions-hugo@v2
          with:
            hugo-version: '0.115.1'
            extended: true

        - name: Build with Hugo
          working-directory: docs
          run: hugo --minify --verbose
            
        - name: Deploy
          uses: peaceiris/actions-gh-pages@v3
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            force_orphan: true
            commit_message: '[skip ci] Deploy:'
            publish_dir: docs/public